const energize={action:{listAction:[],register:function(cssQuery,call,runInBody=!0){this.listAction.push({cssQuery:cssQuery,call:call}),runInBody&&this.runOne(document.body,{cssQuery:cssQuery,call:call})},run:function(element){this.listAction.forEach(action=>{this.runOne(element,action)})},runOne:function(element,action){element.querySelectorAll(action.cssQuery).forEach(action.call)}},location:{update:function(url){url!=window.location&&history.pushState({urlPath:url},null,url)},redirect:function(url){url?window.location.href=url:document.location.reload(!0)},reload:function(url){url||(url=window.location.href),energize.page.contentAjax(url,document.getElementById("content"))}},ajax:{load:function({url:url,method:method="get",data:data=null,header:header={},success:success,error:error}){(url=url.includes("://")?new URL(url):new URL(url,window.location.href)).searchParams.set("_",(new Date).getTime()),success=success||this.success,error=error||this.error;let xhr=new XMLHttpRequest;xhr.open(method,url),Object.keys(header).forEach(name=>{xhr.setRequestHeader(name,header[name])}),xhr.setRequestHeader("X-REQUESTED-WITH","XMLHTTPREQUEST"),xhr.onreadystatechange=()=>{4==xhr.readyState&&(200==xhr.status?success(xhr):error(xhr))},xhr.send(data)},success:function(xhr){energize.page.content(xhr.responseText,document.getElementById("content"))},error:function(xhr){energize.alert.add(xhr.responseText?xhr.responseText:xhr.status,"negative")}},alert:{add:function(content,theme=null,position){(position=this.positionMap[position])||(position="top");let alertBox=document.body.querySelector(":scope > .alert-"+position);alertBox||(alertBox=document.createElement("div"),alertBox.classList.add("alertBox"),alertBox.classList.add("alert-"+position),document.body.appendChild(alertBox));let alert=document.createElement("div");theme&&alert.setAttribute("class",theme),alert.innerHTML=content;let removeAlert=()=>{alert.classList.add("out"),alert.addEventListener("animationend",()=>{alert.remove(),alertBox.childNodes.length||alertBox.remove()})};alert.addEventListener("click",()=>{removeAlert()}),alertBox.appendChild(alert),energize.action.run(alert),setTimeout(()=>{alert&&removeAlert()},5e3)},positionMap:{0:"center",1:"center-left",2:"top-left",3:"top",4:"top-right",5:"center-right",6:"bottom-right",7:"bottom",8:"bottom-left",top:"top","top-left":"top-left","top-center":"top","top-right":"top-right","top-bottom":"center",center:"center","center-left":"center-left","center-center":"center","center-right":"center-right","center-bottom":"bottom","center-top":"top",bottom:"bottom","bottom-left":"bottom-left","bottom-center":"bottom","bottom-right":"bottom-right","bottom-top":"center",right:"center-right","right-center":"center-right","right-top":"top-right","right-bottom":"bottom-right",left:"center-left","left-center":"center-left","left-top":"top-left","left-bottom":"bottom-left"}},aside:{content:function(content=null,position){(position=this.positionMap[position])||(position="");let showAside=document.getElementById("aside-box");showAside.classList=position,showAside.innerHTML=content?'<div id="aside-content">'+content+"</div>":"",showAside.innerHTML+='<div id="aside-shadow" closeAside></div>',showAside.innerHTML+='<div id="aside-button-close" closeAside><i class="fa-solid fa-xmark"></i></div>',energize.action.run(showAside)},open:function(){document.getElementById("aside").classList.add("animateOpen"),document.body.classList.add("showAside"),document.querySelector("#aside.animateOpen").onanimationend=()=>{document.getElementById("aside").classList.remove("animateOpen")}},close:function(){document.body.classList.contains("showAside")&&(document.getElementById("aside").classList.add("animateClose"),document.getElementById("aside").onanimationend=()=>{document.body.classList.remove("showAside"),document.getElementById("aside").classList.remove("animateClose")})},positionMap:{center:"center",left:"left",top:"top",right:"right",bottom:"bottom",full:"full"}},page:{title:function(title){document.title=title},favicon:function(faviconUrl){document.getElementById("favicon").setAttribute("href",faviconUrl)},formatStructure:function(){document.getElementById("content")||(document.getElementById("structure").innerHTML='<div slot id="content">'+document.getElementById("structure").innerHTML+"</div>")},loading:function(target,status=!0){status?target.classList.add("loading"):target.classList.remove("loading")},content:function(content,target,position){this.loading(target,!1);let id=target.id;if("aside"==id)return energize.aside.open(),void energize.aside.content(content,position);"content"!=id&&"structure"!=id||energize.aside.close(),target.innerHTML=content,"structure"==id&&this.formatStructure(),energize.action.run(target)},contentAjax:function(url,target,position){if("aside"==target.id&&energize.aside.content(""),this.loading(target,!0),"content"==target.id){const template=document.body.getAttribute("template");energize.ajax.load({url:url,header:{"X-Energize-Template":template},success:xhr=>{energize.location.update(url);let recivedTemplate=xhr.getResponseHeader("X-Energize-Template");recivedTemplate!=template&&(document.body,target=document.getElementById("structure"),document.body.setAttribute("template",recivedTemplate)),this.content(xhr.responseText,target,position),xhr.getResponseHeader("X-Energize-Title")&&energize.page.title(xhr.getResponseHeader("X-Energize-Title")),xhr.getResponseHeader("X-Energize-Favicon")&&energize.page.favicon(xhr.getResponseHeader("X-Energize-Favicon"))}})}else energize.ajax.load({url:url,success:xhr=>{this.content(xhr.responseText,target,position)}})}}};document.addEventListener("DOMContentLoaded",()=>{document.onkeydown=function(e){"Escape"===e.key&&energize.aside.close()},document.getElementById("structure")||(document.body.innerHTML='<div slot id="structure">'+document.body.innerHTML+"</div>"),energize.page.formatStructure(),document.body.innerHTML+='<div id="aside"><div id="aside-box"></div></div>',document.body.innerHTML+='<div id="commands" hidden></div>',console.log("⚡ENERGIZE⚡"),document.dispatchEvent(new Event("energize"))}),_page=new Object;const actionEnergizeClickHref=event=>{event.preventDefault(),element=event.currentTarget,energize.page.contentAjax(element.getAttribute("href"),document.getElementById(element.getAttribute("target")),element.getAttribute("position"))},actionEnergizeClickCopy=event=>{event.preventDefault(),element=event.currentTarget,energize.page.content(document.getElementById(element.getAttribute("copy")).innerHTML,document.getElementById(element.getAttribute("target")),element.getAttribute("position"))},actionEnergizeClickToggle=event=>{event.preventDefault(),element=event.currentTarget,element.getAttribute("target")?target=document.getElementById(element.getAttribute("target")):target=element,target.classList.toggle(element.getAttribute("toggle"))},actionEnergizeClickCloseAside=event=>{event.preventDefault(),element=event.currentTarget,energize.aside.close()},actionEnergizeSubmit=event=>{event.preventDefault(),element=event.currentTarget,energize.page.loading(element,!0);let data=new FormData(element),target=document.getElementById(element.getAttribute("target")),position=element.getAttribute("position"),method=element.getAttribute("method");method||(method="post"),element.getAttribute("key")&&data.append("formKey",element.getAttribute("key")),energize.ajax.load({url:element.action,method:method,data:data,success:xhr=>{"content"==target.id&&energize.location.update(url),energize.page.loading(element,!1),energize.page.content(xhr.responseText,target,position)},error:xhr=>{energize.page.loading(element,!1),energize.ajax.error(xhr)}})},actionEnergizeImageShow=event=>{event.preventDefault(),element=event.currentTarget,energize.page.content("<img src="+element.getAttribute("src")+"/>",document.getElementById(element.getAttribute("target")),element.getAttribute("position"))};document.addEventListener("energize",()=>{energize.action.register("[redirect]",element=>{energize.location.redirect(element.getAttribute("redirect")),element.remove()}),energize.action.register("[reload]",element=>{energize.location.reload(element.getAttribute("reload")),element.remove()}),energize.action.register("script:not([executed])",element=>{element.setAttribute("executed",!0),eval(element.innerHTML)},!1),energize.action.register("[href][target]",element=>{element.getAttribute("target")||element.setAttribute("target","content"),"_blank"!=element.getAttribute("target")&&"_self"!=element.getAttribute("target")&&"_parent"!=element.getAttribute("target")&&"_top"!=element.getAttribute("target")&&(element.removeEventListener("click",actionEnergizeClickHref),element.addEventListener("click",actionEnergizeClickHref))}),energize.action.register("img[target]:not([href])",element=>{element.getAttribute("target")||element.setAttribute("target","aside"),element.removeEventListener("click",actionEnergizeImageShow),element.addEventListener("click",actionEnergizeImageShow)}),energize.action.register("[copy]",element=>{element.getAttribute("target")?(element.removeEventListener("click",actionEnergizeClickCopy),element.addEventListener("click",actionEnergizeClickCopy)):(energize.page.content(document.getElementById(element.getAttribute("copy")).innerHTML,element),element.removeAttribute("copy"))}),energize.action.register("[replace]",element=>{element.getAttribute("target")&&energize.page.content(element.innerHTML,document.getElementById(element.getAttribute("target")),element.getAttribute("position")),element.remove()}),energize.action.register("[load]",element=>{element.getAttribute("target")?(energize.page.contentAjax(element.getAttribute("load"),document.getElementById(element.getAttribute("target")),element.getAttribute("position")),element.remove()):(energize.page.contentAjax(element.getAttribute("load"),element),element.removeAttribute("load"))}),energize.action.register("[toggle]",element=>{element.removeEventListener("click",actionEnergizeClickToggle),element.addEventListener("click",actionEnergizeClickToggle)}),energize.action.register("[closeAside]",element=>{element.getAttribute("closeAside")?(element.remove(),energize.aside.close()):(element.removeEventListener("click",actionEnergizeClickCloseAside),element.addEventListener("click",actionEnergizeClickCloseAside))}),energize.action.register("[alert]",element=>{energize.alert.add(element.innerHTML,element.getAttribute("alert"),element.getAttribute("position")),element.remove()}),energize.action.register("form[target]",element=>{element.getAttribute("target")||element.setAttribute("target","commands"),element.removeEventListener("submit",actionEnergizeSubmit),element.addEventListener("submit",actionEnergizeSubmit)}),energize.action.register("label[field]",element=>{element.querySelectorAll("input:not([type=radio]):not([type=checkbox]):not([type=file]), label[field] textarea").forEach(subElement=>{subElement.placeholder=" "}),element.querySelectorAll("input[type=file]").forEach(subElement=>{subElement.parentElement.childElementCount<3&&element.insertBefore(document.createElement("span"),subElement.parentElement.children[1]),subElement.addEventListener("change",event=>{subElement.parentElement.children[1].innerHTML=subElement.value.split("\\").pop()})}),element.querySelectorAll("input[type=range]").forEach(subElement=>{subElement.parentElement.childElementCount<3&&element.insertBefore(document.createElement("span"),subElement.parentElement.children[1]),subElement.parentElement.children[1].innerHTML=subElement.value,subElement.addEventListener("input",event=>{subElement.parentElement.children[1].innerHTML=subElement.value})})}),energize.action.register("table[dinamic]",element=>{import("https://cdn.jsdelivr.net/npm/simple-datatables@latest").then(async()=>{let options=(()=>{try{return JSON.parse(element.getAttribute("dinamic"))}catch(e){return{}}})();options.labels={placeholder:"Buscar...",perPage:"{select}",noRows:"Nenhum registro encontrado",noResults:"Nenhum registro encontrado",info:"({start} ao {end}) de {rows}",...options.labels?options.labels:{}};let table=new simpleDatatables.DataTable(element,options);table.on("datatable.init",()=>{energize.action.run(element)}),table.on("datatable.update",()=>{energize.action.run(element)}),table.on("datatable.page",()=>{energize.action.run(element)}),energize.action.run(element.closest(".dataTable-wrapper").querySelector(".dataTable-top"))})})}),window.onpopstate=()=>{location.reload()};